<div class="main">
    <div class="form-container">
      <div class="form-title">
        <h1>Enquiry Officers Form</h1>
      </div>
      <form [formGroup]="complaintForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <div class="form-column columnOne">
            <div *ngFor="let field of leftColumnFields" class="form-group">
              <div class="input-container">
                <input *ngIf="field.type !== 'dropdown' && field.type !== 'button' && field.type !== 'readonly' && field.type !== 'textarea' && field.type !== 'file'"
                       [formControlName]="field.name"
                       [type]="field.type"
                       [readonly]="field.readonly"
                       [disabled]="field.disabled"
                       (focus)="onFocus(field.name)"
                       (blur)="onBlur(field.name)"
                       [ngClass]="{'active': isActive(field.name)}">
                <select *ngIf="field.type === 'dropdown'"
                        [formControlName]="field.name"  
                        (focus)="onFocus(field.name)"
                        (blur)="onBlur(field.name)"
                        [ngClass]="{'active': isActive(field.name)}">
                  <option *ngFor="let option of field.options" [value]="option">{{ option }}</option>
                </select>
                <textarea *ngIf="field.type === 'textarea'"
                          [formControlName]="field.name"
                          (focus)="onFocus(field.name)"
                          (blur)="onBlur(field.name)"
                          [ngClass]="{'active': isActive(field.name)}"></textarea>
                <input *ngIf="field.type === 'file'"
                       type="file"
                       [formControlName]="field.name"
                       (focus)="onFocus(field.name)"
                       (blur)="onBlur(field.name)"
                       [ngClass]="{'active': isActive(field.name)}">
                <button *ngIf="field.type === 'button'" type="button" (click)="showPopup()" class="AtrButton">{{ field.label }}<span *ngIf="!field.readonly && !field.disabled" class="star">*</span></button>
        
                <div *ngIf="field.type === 'readonly' && field.value">{{ field.value }}</div>
                <label *ngIf="field.type!=='button'" [ngClass]="{'active': isActive(field.name)}">{{ field.label }} <span *ngIf="!field.readonly && !field.disabled" class="star">*</span></label>

                <small class="error-message" *ngIf="complaintForm.get(field.name)?.invalid && complaintForm.get(field.name)?.touched">
                  Please fill in the {{ field.label }} field.
                </small>
              </div>
            </div>
          </div>
          <div class="form-column">
            <div *ngFor="let field of rightColumnFields" class="form-group">
              <div class="input-container">
                <input *ngIf="field.type !== 'dropdown' && field.type !== 'readonly' && field.type !== 'textarea' && field.type !== 'file'"
                       [formControlName]="field.name"
                       [type]="field.type"
                       [readonly]="field.readonly"
                       [disabled]="field.disabled"
                       (focus)="onFocus(field.name)"
                       (blur)="onBlur(field.name)"
                       [ngClass]="{'active': isActive(field.name)}">
                <select *ngIf="field.type === 'dropdown'"
                        [formControlName]="field.name"
                        (focus)="onFocus(field.name)"
                        (blur)="onBlur(field.name)"
                        [ngClass]="{'active': isActive(field.name)}">
                  <option *ngFor="let option of field.options" [value]="option">{{ option }}</option>
                </select>
                <textarea *ngIf="field.type === 'textarea'"
                          [formControlName]="field.name"
                          (focus)="onFocus(field.name)"
                          (blur)="onBlur(field.name)"
                          [ngClass]="{'active': isActive(field.name)}"></textarea>
                <input *ngIf="field.type === 'file'"
                       type="file"
                       [formControlName]="field.name"
                       (focus)="onFocus(field.name)"
                       (blur)="onBlur(field.name)"
                       [ngClass]="{'active': isActive(field.name)}">
                <div *ngIf="field.type === 'readonly' && field.value">{{ field.value }}</div>
                <label [ngClass]="{'active': isActive(field.name)}">{{ field.label }} <span *ngIf="!field.readonly && !field.disabled" class="star">*</span></label>
                <small class="error-message" *ngIf="complaintForm.get(field.name)?.invalid && complaintForm.get(field.name)?.touched">
                  Please fill in the {{ field.label }} field.
                </small>
              </div>
            </div>
          </div>
        </div>
        <button type="submit" class="btn">Submit</button>
      </form>
    </div>
  </div>
  
  <!-- Popup Window -->
  <div class="popup-window" *ngIf="isPopupVisible">
    <div class="popup-content">
      <div class="form-title">
        <h1>ATR Preliminary Details</h1>
      </div>
      <form [formGroup]="popupForm" (ngSubmit)="onPopupSubmit()">
        <div class="form-row">
          <div class="form-column columnOne">
            <div class="form-group" *ngFor="let field of popupWindowFields">
              <div class="input-container" *ngIf="!['CrimeLocation', 'Cr', 'Casesbooked', 'US', 'PersonsArrested', 'ComplaintSource', 'ContrabandValue'].includes(field.name)|| showConditionalFields">
                <input *ngIf="field.type !== 'dropdown' && field.type !== 'readonly' && field.type !== 'textarea' && field.type !== 'file'"
                       [formControlName]="field.name"
                       [type]="field.type"
                       [readonly]="field.readonly"
                       [disabled]="field.disabled"
                       (focus)="onFocus(field.name)"
                       (blur)="onBlur(field.name)"
                       [ngClass]="{'active': isActive(field.name)}">
                <select *ngIf="field.type === 'dropdown'"
                        [formControlName]="field.name"  
                        (focus)="onFocus(field.name)"
                        (blur)="onBlur(field.name)"
                        [ngClass]="{'active': isActive(field.name)}">
                  <option *ngFor="let option of field.options" [value]="option">{{ option }}</option>
                </select>
                <textarea *ngIf="field.type === 'textarea'"
                          [formControlName]="field.name"
                          (focus)="onFocus(field.name)"
                          (blur)="onBlur(field.name)"
                          [ngClass]="{'active': isActive(field.name)}"></textarea>
                <input *ngIf="field.type === 'file'"
                       type="file"
                       [formControlName]="field.name"
                       (focus)="onFocus(field.name)"
                       (blur)="onBlur(field.name)"
                       [ngClass]="{'active': isActive(field.name)}">
                <div *ngIf="field.type === 'readonly' && field.value">{{ field.value }}</div>
                <label [ngClass]="{'active': isActive(field.name)}">{{ field.label }} <span *ngIf="!field.readonly && !field.disabled" class="star">*</span></label>
                <small class="error-message" *ngIf="popupForm.get(field.name)?.invalid && popupForm.get(field.name)?.touched">
                  Please fill in the {{ field.label }} field.
                </small>
              </div>
            </div>
          </div>
        </div>
        <div class="popupBtns">
          <button type="submit">Submit</button>
          <button type="button" (click)="hidePopup()">Close</button>
        </div>
      </form>
    </div>
  </div>
  